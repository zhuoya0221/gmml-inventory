(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[974],{63:(e,t,s)=>{"use strict";var r=s(7260);s.o(r,"useRouter")&&s.d(t,{useRouter:function(){return r.useRouter}})},1593:(e,t,s)=>{Promise.resolve().then(s.bind(s,8382))},8382:(e,t,s)=>{"use strict";s.r(t),s.d(t,{default:()=>w});var r=s(5155),o=s(2115),a=s(63),n=s(2890),l=s(2663),i=s(5299),c=s(6617),d=s(4485),u=s(9867),m=s(6191);let g=(0,s(1847).A)("funnel",[["path",{d:"M10 20a1 1 0 0 0 .553.895l2 1A1 1 0 0 0 14 21v-7a2 2 0 0 1 .517-1.341L21.74 4.67A1 1 0 0 0 21 3H3a1 1 0 0 0-.742 1.67l7.225 7.989A2 2 0 0 1 10 14z",key:"sc7q7i"}]]);var x=s(6651),h=s(6509),f=s(7098),p=s(9315),y=s(5511),j=s(1398),b=s(1251);function v(){console.log("\uD83D\uDCCA InventoryDashboard component loaded!");let[e,t]=(0,o.useState)(null),[s,v]=(0,o.useState)(!0),[w,N]=(0,o.useState)([]),[S,k]=(0,o.useState)([]),[A,C]=(0,o.useState)(""),[L,_]=(0,o.useState)(""),[E,R]=(0,o.useState)(""),[O,U]=(0,o.useState)(""),[I,D]=(0,o.useState)(!1),[M,F]=(0,o.useState)(!1),[q,V]=(0,o.useState)(!1),[z,B]=(0,o.useState)(null),[G,H]=(0,o.useState)([]),[P,T]=(0,o.useState)([]),[J,K]=(0,o.useState)([]),Q=(0,a.useRouter)();(0,o.useEffect)(()=>{W()},[]),(0,o.useEffect)(()=>{e&&(X(),Y())},[e]),(0,o.useEffect)(()=>{Z()},[w,A,L,E,O]);let W=async()=>{console.log("\uD83D\uDD0D Checking user authentication...");try{let{data:{user:e}}=await n.N.auth.getUser();if(console.log("\uD83D\uDC64 User data:",e),!e){console.log("❌ No user found, redirecting to login..."),Q.push("/login");return}console.log("✅ User authenticated:",e.email),t(e)}catch(e){console.error("\uD83D\uDCA5 Error checking user:",e),Q.push("/login")}finally{v(!1)}},X=async()=>{try{let{data:e,error:t}=await n.N.from("inventory_items").select("*").order("updated_at",{ascending:!1});if(t)throw t;N(e||[]);let s=[...new Set((null==e?void 0:e.map(e=>e.category))||[])],r=[...new Set((null==e?void 0:e.map(e=>e.storage_location))||[])];T(s),K(r)}catch(e){console.error("Error fetching items:",e),l.oR.error("Failed to fetch inventory items")}},Y=async()=>{try{let{data:e,error:t}=await n.N.from("activity_logs").select("*").order("timestamp",{ascending:!1}).limit(100);if(t)throw t;H(e||[])}catch(e){console.error("Error fetching activity logs:",e)}},Z=()=>{let e=w;A&&(e=e.filter(e=>e.name.toLowerCase().includes(A.toLowerCase()))),L&&(e=e.filter(e=>e.category===L)),E&&(e=e.filter(e=>e.storage_location===E)),O&&(e=e.filter(e=>e.status===O)),k(e)},$=async()=>{let{error:e}=await n.N.auth.signOut();e?l.oR.error("Error signing out"):Q.push("/login")},ee=async e=>{if(confirm("Are you sure you want to delete this item?"))try{let{error:t}=await n.N.from("inventory_items").delete().eq("id",e);if(t)throw t;l.oR.success("Item deleted successfully"),X(),Y()}catch(e){console.error("Error deleting item:",e),l.oR.error("Failed to delete item")}};return s?(0,r.jsx)("div",{className:"min-h-screen bg-gray-50 flex items-center justify-center",children:(0,r.jsx)(i.A,{className:"h-8 w-8 animate-spin text-indigo-600"})}):(0,r.jsxs)("div",{className:"min-h-screen bg-gray-50",children:[(0,r.jsx)(j.A,{user:e,onSignOut:$}),(0,r.jsxs)("main",{className:"max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-8",children:[(0,r.jsx)("div",{className:"mb-8",children:(0,r.jsxs)("div",{className:"flex items-center justify-between",children:[(0,r.jsxs)("div",{children:[(0,r.jsxs)("h1",{className:"text-3xl font-bold text-gray-900 flex items-center gap-2",children:[(0,r.jsx)(c.A,{className:"h-8 w-8 text-indigo-600"}),"GMML Inventory"]}),(0,r.jsx)("p",{className:"text-gray-600 mt-1",children:"Manage your team's inventory and track changes"})]}),(0,r.jsxs)("div",{className:"flex items-center gap-4",children:[(0,r.jsxs)("button",{onClick:()=>V(!0),className:"flex items-center gap-2 px-4 py-2 text-sm font-medium text-gray-700 bg-white border border-gray-300 rounded-md hover:bg-gray-50",children:[(0,r.jsx)(d.A,{className:"h-4 w-4"}),"Activity Log"]}),(0,r.jsxs)("button",{onClick:()=>{let e=new Blob([["Name,Category,Current Stock,Min Stock,Status,Storage Location,Date Updated",...S.map(e=>['"'.concat(e.name,'"'),'"'.concat(e.category,'"'),e.current_stock,e.min_stock,'"'.concat(e.status,'"'),'"'.concat(e.storage_location,'"'),'"'.concat(new Date(e.updated_at).toLocaleDateString(),'"')].join(","))].join("\n")],{type:"text/csv"}),t=window.URL.createObjectURL(e),s=document.createElement("a");s.href=t,s.download="inventory-".concat(new Date().toISOString().split("T")[0],".csv"),s.click(),window.URL.revokeObjectURL(t),l.oR.success("Inventory exported to CSV")},className:"flex items-center gap-2 px-4 py-2 text-sm font-medium text-gray-700 bg-white border border-gray-300 rounded-md hover:bg-gray-50",children:[(0,r.jsx)(u.A,{className:"h-4 w-4"}),"Export CSV"]}),(0,r.jsxs)("button",{onClick:()=>D(!0),className:"flex items-center gap-2 px-4 py-2 text-sm font-medium text-white bg-indigo-600 border border-transparent rounded-md hover:bg-indigo-700",children:[(0,r.jsx)(m.A,{className:"h-4 w-4"}),"Add Item"]})]})]})}),(0,r.jsx)(b.A,{items:w}),(0,r.jsxs)("div",{className:"bg-white p-6 rounded-lg shadow mb-6",children:[(0,r.jsxs)("h2",{className:"text-lg font-medium text-gray-900 mb-4 flex items-center gap-2",children:[(0,r.jsx)(g,{className:"h-5 w-5"}),"Filters & Search"]}),(0,r.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-4",children:[(0,r.jsxs)("div",{children:[(0,r.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Search by name"}),(0,r.jsxs)("div",{className:"relative",children:[(0,r.jsx)(x.A,{className:"absolute left-3 top-1/2 transform -translate-y-1/2 h-4 w-4 text-gray-400"}),(0,r.jsx)("input",{type:"text",value:A,onChange:e=>C(e.target.value),className:"w-full pl-10 pr-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-indigo-500 focus:border-transparent",placeholder:"Search items..."})]})]}),(0,r.jsxs)("div",{children:[(0,r.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Category"}),(0,r.jsxs)("select",{value:L,onChange:e=>_(e.target.value),className:"w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-indigo-500 focus:border-transparent",children:[(0,r.jsx)("option",{value:"",children:"All Categories"}),P.map(e=>(0,r.jsx)("option",{value:e,children:e},e))]})]}),(0,r.jsxs)("div",{children:[(0,r.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Location"}),(0,r.jsxs)("select",{value:E,onChange:e=>R(e.target.value),className:"w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-indigo-500 focus:border-transparent",children:[(0,r.jsx)("option",{value:"",children:"All Locations"}),J.map(e=>(0,r.jsx)("option",{value:e,children:e},e))]})]}),(0,r.jsxs)("div",{children:[(0,r.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Status"}),(0,r.jsxs)("select",{value:O,onChange:e=>U(e.target.value),className:"w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-indigo-500 focus:border-transparent",children:[(0,r.jsx)("option",{value:"",children:"All Status"}),(0,r.jsx)("option",{value:"In Stock",children:"In Stock"}),(0,r.jsx)("option",{value:"Low Stock",children:"Low Stock"}),(0,r.jsx)("option",{value:"Out of Stock",children:"Out of Stock"})]})]})]})]}),(0,r.jsx)(h.A,{items:S,onEdit:e=>{B(e),F(!0)},onDelete:ee})]}),I&&(0,r.jsx)(f.A,{onClose:()=>D(!1),onSuccess:()=>{D(!1),X(),Y()}}),M&&z&&(0,r.jsx)(p.A,{item:z,onClose:()=>{F(!1),B(null)},onSuccess:()=>{F(!1),B(null),X(),Y()}}),q&&(0,r.jsx)(y.A,{logs:G,onClose:()=>V(!1)})]})}function w(){let[e,t]=(0,o.useState)(!0),[s,l]=(0,o.useState)(null),i=(0,a.useRouter)();(0,o.useEffect)(()=>{c()},[]);let c=async()=>{try{let{data:{user:e}}=await n.N.auth.getUser();if(!e)return void i.push("/login");l(e)}catch(e){console.error("Auth check error:",e),i.push("/login");return}finally{t(!1)}};return e?(0,r.jsx)("div",{className:"min-h-screen flex items-center justify-center",children:(0,r.jsxs)("div",{className:"text-center",children:[(0,r.jsx)("div",{className:"animate-spin rounded-full h-8 w-8 border-b-2 border-indigo-600 mx-auto"}),(0,r.jsx)("p",{className:"mt-2 text-gray-600",children:"Loading..."})]})}):(0,r.jsx)(v,{})}}},e=>{e.O(0,[945,663,396,629,441,255,358],()=>e(e.s=1593)),_N_E=e.O()}]);