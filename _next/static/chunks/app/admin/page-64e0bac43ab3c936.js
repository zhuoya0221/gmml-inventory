(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[698],{2563:(e,t,a)=>{"use strict";a.r(t),a.d(t,{default:()=>d});var s=a(5155),i=a(2115),r=a(63),o=a(2890),n=a(2663),c=a(6830);function d(){let[e,t]=(0,i.useState)(null),[a,d]=(0,i.useState)(null),[l,m]=(0,i.useState)([]),[u,x]=(0,i.useState)([]),[g,h]=(0,i.useState)([]),[p,y]=(0,i.useState)(!0),[f,b]=(0,i.useState)("users"),[N,v]=(0,i.useState)(!1),[w,j]=(0,i.useState)(null),[k,A]=(0,i.useState)(""),[C,I]=(0,i.useState)(""),S=(0,r.useRouter)();(0,i.useEffect)(()=>{(async()=>{y(!0);let{data:{user:e}}=await o.N.auth.getUser();if(!e)return S.push((0,c.vX)("/team-dashboard"));t(e);let{data:a,error:s}=await o.N.from("profiles").select("*").eq("id",e.id).single();if(s||!a){n.Ay.error("Could not fetch your user profile."),S.push((0,c.vX)("/team-dashboard"));return}if(d(a),"admin"!==a.role){n.Ay.error("You don't have permission to view this page."),S.push((0,c.vX)("/team-dashboard"));return}y(!1),Promise.all([E(),F(),D()]).catch(e=>{console.error("Error fetching admin data:",e)})})()},[S]);let E=async()=>{let{data:e,error:t}=await o.N.from("profiles").select("*").order("email",{ascending:!0});t?n.Ay.error("Failed to fetch user list."):m(e||[])},F=async()=>{try{let{data:e,error:t}=await o.N.from("categories").select("*").order("name",{ascending:!0});if(!t&&e)return void x(e);let{data:a,error:s}=await o.N.functions.invoke("manage-categories?action=list");s?n.Ay.error("Failed to fetch categories."):x(a.data||[])}catch(e){console.error("Error fetching categories:",e),n.Ay.error("Failed to fetch categories.")}},D=async()=>{try{let{data:e,error:t}=await o.N.from("locations").select("*").order("name",{ascending:!0});if(!t&&e)return void h(e);let{data:a,error:s}=await o.N.functions.invoke("manage-locations?action=list");s?n.Ay.error("Failed to fetch locations."):h(a.data||[])}catch(e){console.error("Error fetching locations:",e),n.Ay.error("Failed to fetch locations.")}},U=async(t,a)=>{if(t===(null==e?void 0:e.id)&&"admin"!==a)return void n.Ay.error("You cannot remove your own admin status.");let{error:s}=await o.N.functions.invoke("set-user-role",{body:{userId:t,role:a}});s?n.Ay.error("Failed to update role: ".concat(s.message)):(n.Ay.success("User role updated successfully!"),m(l.map(e=>e.id===t?{...e,role:a}:e)))},X=async()=>{if(!k.trim())return void n.Ay.error("Name is required");let e="categories"===f?"manage-categories?action=create":"manage-locations?action=create",{data:t,error:a}=await o.N.functions.invoke(e,{body:{name:k.trim(),description:C.trim()||null}});a?n.Ay.error("Failed to add ".concat(f.slice(0,-1),": ").concat(a.message)):(n.Ay.success("".concat(f.slice(0,-1)," added successfully!")),"categories"===f?x([...u,t.data]):h([...g,t.data]),v(!1),A(""),I(""))},_=async()=>{if(!w||!k.trim())return void n.Ay.error("Name is required");let e="categories"===f?"manage-categories?action=update":"manage-locations?action=update",{data:t,error:a}=await o.N.functions.invoke(e,{body:{id:w.id,name:k.trim(),description:C.trim()||null}});a?n.Ay.error("Failed to update ".concat(f.slice(0,-1),": ").concat(a.message)):(n.Ay.success("".concat(f.slice(0,-1)," updated successfully!")),"categories"===f?x(u.map(e=>e.id===w.id?t.data:e)):h(g.map(e=>e.id===w.id?t.data:e)),j(null),A(""),I(""))},z=async e=>{if(!confirm('Are you sure you want to delete "'.concat(e.name,'"? This action cannot be undone.')))return;let t="categories"===f?"manage-categories?action=delete":"manage-locations?action=delete",{error:a}=await o.N.functions.invoke(t,{body:{id:e.id}});a?n.Ay.error("Failed to delete ".concat(f.slice(0,-1),": ").concat(a.message)):(n.Ay.success("".concat(f.slice(0,-1)," deleted successfully!")),"categories"===f?x(u.filter(t=>t.id!==e.id)):h(g.filter(t=>t.id!==e.id)))};return p||!a||"admin"!==a.role?(0,s.jsx)("div",{className:"flex h-screen items-center justify-center",children:(0,s.jsx)("p",{className:"text-lg",children:"Loading Admin Dashboard..."})}):(0,s.jsxs)(s.Fragment,{children:[(0,s.jsx)(n.Toaster,{position:"top-right"}),(0,s.jsxs)("div",{className:"min-h-screen bg-gray-50",children:[(0,s.jsx)("header",{className:"bg-white shadow-sm border-b",children:(0,s.jsx)("div",{className:"mx-auto max-w-7xl px-4 py-6 sm:px-6 lg:px-8",children:(0,s.jsxs)("div",{className:"flex items-center justify-between",children:[(0,s.jsx)("h1",{className:"text-2xl font-bold text-gray-900",children:"Admin Dashboard"}),(0,s.jsx)("button",{onClick:()=>S.push((0,c.vX)("/team-dashboard")),className:"text-sm font-semibold text-indigo-600 hover:text-indigo-800",children:"Back to Dashboard"})]})})}),(0,s.jsxs)("main",{className:"mx-auto max-w-7xl py-6 sm:px-6 lg:px-8",children:[(0,s.jsx)("div",{className:"border-b border-gray-200 mb-6",children:(0,s.jsx)("nav",{className:"-mb-px flex space-x-8",children:[{id:"users",name:"User Management"},{id:"categories",name:"Categories"},{id:"locations",name:"Locations"}].map(e=>(0,s.jsx)("button",{onClick:()=>b(e.id),className:"".concat(f===e.id?"border-indigo-500 text-indigo-600":"border-transparent text-gray-500 hover:text-gray-700 hover:border-gray-300"," whitespace-nowrap py-2 px-1 border-b-2 font-medium text-sm"),children:e.name},e.id))})}),(0,s.jsxs)("div",{className:"bg-white shadow-sm rounded-lg border border-gray-200",children:["users"===f&&(0,s.jsx)("div",{className:"overflow-x-auto",children:(0,s.jsxs)("table",{className:"min-w-full divide-y divide-gray-200",children:[(0,s.jsx)("thead",{className:"bg-gray-50",children:(0,s.jsxs)("tr",{children:[(0,s.jsx)("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Email"}),(0,s.jsx)("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Role"}),(0,s.jsx)("th",{className:"px-6 py-3 text-right text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Actions"})]})}),(0,s.jsx)("tbody",{className:"bg-white divide-y divide-gray-200",children:l.map(t=>(0,s.jsxs)("tr",{children:[(0,s.jsx)("td",{className:"px-6 py-4 whitespace-nowrap text-sm font-medium text-gray-900",children:t.email}),(0,s.jsx)("td",{className:"px-6 py-4 whitespace-nowrap text-sm text-gray-500",children:t.role}),(0,s.jsx)("td",{className:"px-6 py-4 whitespace-nowrap text-right text-sm font-medium",children:(0,s.jsxs)("select",{value:t.role,onChange:e=>U(t.id,e.target.value),disabled:t.id===(null==e?void 0:e.id),className:"rounded-md border-gray-300 shadow-sm focus:border-indigo-300 focus:ring focus:ring-indigo-200 focus:ring-opacity-50 disabled:bg-gray-100 disabled:cursor-not-allowed text-gray-900",children:[(0,s.jsx)("option",{value:"admin",children:"admin"}),(0,s.jsx)("option",{value:"member",children:"member"}),(0,s.jsx)("option",{value:"user",children:"user"})]})})]},t.id))})]})}),("categories"===f||"locations"===f)&&(0,s.jsxs)(s.Fragment,{children:[(0,s.jsx)("div",{className:"px-6 py-4 border-b border-gray-200",children:(0,s.jsxs)("button",{onClick:()=>{v(!0),A(""),I("")},className:"inline-flex items-center px-4 py-2 border border-transparent text-sm font-medium rounded-md shadow-sm text-white bg-indigo-600 hover:bg-indigo-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-indigo-500",children:["Add ",f.slice(0,-1)]})}),(0,s.jsx)("div",{className:"overflow-x-auto",children:(0,s.jsxs)("table",{className:"min-w-full divide-y divide-gray-200",children:[(0,s.jsx)("thead",{className:"bg-gray-50",children:(0,s.jsxs)("tr",{children:[(0,s.jsx)("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Name"}),(0,s.jsx)("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Description"}),(0,s.jsx)("th",{className:"px-6 py-3 text-right text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Actions"})]})}),(0,s.jsx)("tbody",{className:"bg-white divide-y divide-gray-200",children:("categories"===f?u:g).map(e=>(0,s.jsxs)("tr",{children:[(0,s.jsx)("td",{className:"px-6 py-4 whitespace-nowrap text-sm font-medium text-gray-900",children:e.name}),(0,s.jsx)("td",{className:"px-6 py-4 whitespace-nowrap text-sm text-gray-500",children:e.description||"-"}),(0,s.jsxs)("td",{className:"px-6 py-4 whitespace-nowrap text-right text-sm font-medium",children:[(0,s.jsx)("button",{onClick:()=>{j(e),A(e.name),I(e.description||"")},className:"text-indigo-600 hover:text-indigo-900 mr-4",children:"Edit"}),(0,s.jsx)("button",{onClick:()=>z(e),className:"text-red-600 hover:text-red-900",children:"Delete"})]})]},e.id))})]})})]})]})]})]}),(N||w)&&(0,s.jsx)("div",{className:"fixed inset-0 bg-gray-600 bg-opacity-50 overflow-y-auto h-full w-full z-50",children:(0,s.jsxs)("div",{className:"relative top-20 mx-auto p-5 border w-96 shadow-lg rounded-md bg-white",children:[(0,s.jsx)("h3",{className:"text-lg font-medium text-gray-900 mb-4",children:w?"Edit ".concat(f.slice(0,-1)):"Add ".concat(f.slice(0,-1))}),(0,s.jsxs)("div",{className:"mb-4",children:[(0,s.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Name"}),(0,s.jsx)("input",{type:"text",value:k,onChange:e=>A(e.target.value),className:"w-full px-3 py-2 border border-gray-300 rounded-md shadow-sm focus:outline-none focus:ring-indigo-500 focus:border-indigo-500",placeholder:"Enter ".concat(f.slice(0,-1)," name")})]}),(0,s.jsxs)("div",{className:"mb-4",children:[(0,s.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Description (Optional)"}),(0,s.jsx)("textarea",{value:C,onChange:e=>I(e.target.value),rows:3,className:"w-full px-3 py-2 border border-gray-300 rounded-md shadow-sm focus:outline-none focus:ring-indigo-500 focus:border-indigo-500",placeholder:"Enter ".concat(f.slice(0,-1)," description")})]}),(0,s.jsxs)("div",{className:"flex justify-end space-x-3",children:[(0,s.jsx)("button",{onClick:()=>{v(!1),j(null),A(""),I("")},className:"px-4 py-2 text-sm font-medium text-gray-700 bg-gray-200 rounded-md hover:bg-gray-300 focus:outline-none focus:ring-2 focus:ring-gray-500",children:"Cancel"}),(0,s.jsx)("button",{onClick:w?_:X,className:"px-4 py-2 text-sm font-medium text-white bg-indigo-600 rounded-md hover:bg-indigo-700 focus:outline-none focus:ring-2 focus:ring-indigo-500",children:w?"Update":"Add"})]})]})})]})}},2890:(e,t,a)=>{"use strict";a.d(t,{N:()=>s});let s=(0,a(945).UU)("https://ydamkailcnhfmutdvmsk.supabase.co","eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6InlkYW1rYWlsY25oZm11dGR2bXNrIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NTg4NTExMzIsImV4cCI6MjA3NDQyNzEzMn0.8oSPmI_svRRq9GdvsssciUNe0PmD_fkkyhwDG5-FGdA",{auth:{autoRefreshToken:!0,persistSession:!0,detectSessionInUrl:!0}})},6830:(e,t,a)=>{"use strict";a.d(t,{dy:()=>i,vX:()=>s});let s=e=>e.startsWith("/")?e:"/".concat(e),i=e=>{let t=e.startsWith("/")?e:"/".concat(e);return"".concat("/gmml-inventory").concat(t)}},7065:(e,t,a)=>{Promise.resolve().then(a.bind(a,2563))}},e=>{e.O(0,[663,796,441,255,358],()=>e(e.s=7065)),_N_E=e.O()}]);