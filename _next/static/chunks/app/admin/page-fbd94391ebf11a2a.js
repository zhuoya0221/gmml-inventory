(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[698],{2563:(e,s,t)=>{"use strict";t.r(s),t.d(s,{default:()=>n});var a=t(5155),r=t(2115),i=t(63),d=t(2890),l=t(2663);function n(){let[e,s]=(0,r.useState)(null),[t,n]=(0,r.useState)(null),[o,c]=(0,r.useState)([]),[m,u]=(0,r.useState)(!0),h=(0,i.useRouter)();(0,r.useEffect)(()=>{(async()=>{u(!0);let{data:{user:e}}=await d.N.auth.getUser();if(!e)return h.push("/team-dashboard");s(e);let{data:t,error:a}=await d.N.from("profiles").select("*").eq("id",e.id).single();if(a||!t){l.Ay.error("Could not fetch your user profile."),h.push("/team-dashboard");return}if(n(t),"admin"!==t.role){l.Ay.error("You don't have permission to view this page."),h.push("/team-dashboard");return}x(),u(!1)})()},[h]);let x=async()=>{let{data:e,error:s}=await d.N.from("profiles").select("*").order("email",{ascending:!0});s?l.Ay.error("Failed to fetch user list."):c(e||[])},p=async(s,t)=>{if(s===(null==e?void 0:e.id)&&"admin"!==t)return void l.Ay.error("You cannot remove your own admin status.");let{error:a}=await d.N.functions.invoke("set-user-role",{body:{userId:s,role:t}});a?l.Ay.error("Failed to update role: ".concat(a.message)):(l.Ay.success("User role updated successfully!"),c(o.map(e=>e.id===s?{...e,role:t}:e)))};return m||!t||"admin"!==t.role?(0,a.jsx)("div",{className:"flex h-screen items-center justify-center",children:(0,a.jsx)("p",{className:"text-lg",children:"Loading Admin Dashboard..."})}):(0,a.jsxs)(a.Fragment,{children:[(0,a.jsx)(l.Toaster,{position:"top-right"}),(0,a.jsxs)("div",{className:"min-h-screen bg-gray-50",children:[(0,a.jsx)("header",{className:"bg-white shadow-sm border-b",children:(0,a.jsx)("div",{className:"mx-auto max-w-7xl px-4 py-6 sm:px-6 lg:px-8",children:(0,a.jsxs)("div",{className:"flex items-center justify-between",children:[(0,a.jsx)("h1",{className:"text-2xl font-bold text-gray-900",children:"Admin - User Management"}),(0,a.jsx)("button",{onClick:()=>h.push("/team-dashboard"),className:"text-sm font-semibold text-indigo-600 hover:text-indigo-800",children:"Back to Dashboard"})]})})}),(0,a.jsx)("main",{className:"mx-auto max-w-7xl py-6 sm:px-6 lg:px-8",children:(0,a.jsx)("div",{className:"bg-white shadow-sm rounded-lg border border-gray-200",children:(0,a.jsx)("div",{className:"overflow-x-auto",children:(0,a.jsxs)("table",{className:"min-w-full divide-y divide-gray-200",children:[(0,a.jsx)("thead",{className:"bg-gray-50",children:(0,a.jsxs)("tr",{children:[(0,a.jsx)("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Email"}),(0,a.jsx)("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Role"}),(0,a.jsx)("th",{className:"px-6 py-3 text-right text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Actions"})]})}),(0,a.jsx)("tbody",{className:"bg-white divide-y divide-gray-200",children:o.map(s=>(0,a.jsxs)("tr",{children:[(0,a.jsx)("td",{className:"px-6 py-4 whitespace-nowrap text-sm font-medium text-gray-900",children:s.email}),(0,a.jsx)("td",{className:"px-6 py-4 whitespace-nowrap text-sm text-gray-500",children:s.role}),(0,a.jsx)("td",{className:"px-6 py-4 whitespace-nowrap text-right text-sm font-medium",children:(0,a.jsxs)("select",{value:s.role,onChange:e=>p(s.id,e.target.value),disabled:s.id===(null==e?void 0:e.id),className:"rounded-md border-gray-300 shadow-sm focus:border-indigo-300 focus:ring focus:ring-indigo-200 focus:ring-opacity-50 disabled:bg-gray-100 disabled:cursor-not-allowed text-gray-900",children:[(0,a.jsx)("option",{value:"admin",children:"admin"}),(0,a.jsx)("option",{value:"member",children:"member"}),(0,a.jsx)("option",{value:"user",children:"user"})]})})]},s.id))})]})})})})]})]})}},2890:(e,s,t)=>{"use strict";t.d(s,{N:()=>a});let a=(0,t(945).UU)("https://ydamkailcnhfmutdvmsk.supabase.co","eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6InlkYW1rYWlsY25oZm11dGR2bXNrIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NTg4NTExMzIsImV4cCI6MjA3NDQyNzEzMn0.8oSPmI_svRRq9GdvsssciUNe0PmD_fkkyhwDG5-FGdA",{auth:{autoRefreshToken:!0,persistSession:!0,detectSessionInUrl:!0}})},7065:(e,s,t)=>{Promise.resolve().then(t.bind(t,2563))}},e=>{e.O(0,[663,796,441,255,358],()=>e(e.s=7065)),_N_E=e.O()}]);